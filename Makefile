IMAGE := s0md3v/corsy

VERSION := $(shell git describe HEAD --always)
BRANCH := $(shell git rev-parse --abbrev-ref HEAD | tr / -)
NOW=$(shell TZ=UTC date +%Y-%m-%dT%H:%M:%SZ)
BUILD := 0

## test		:	test.
test:
	true

## version	:	display version.
version:
	@echo $(VERSION)

## image		:	build image and tag them.
.PHONY: image
image:
	@docker build --build-arg NOW=$(NOW) -t ${IMAGE}:${VERSION} .
	@docker tag ${IMAGE}:${VERSION} ${IMAGE}:latest

## push-image	:	push docker image.
.PHONY: push-image
push-image:
	@docker push ${IMAGE}:${VERSION}
	@docker push ${IMAGE}:latest

## help		:	Print commands help.
.PHONY: help
help : Makefile
	@sed -n 's/^##//p' $<

# https://stackoverflow.com/a/6273809/1826109
%:
	@:
